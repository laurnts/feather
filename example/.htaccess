# Enable rewrite engine
RewriteEngine On

# Set rewrite base to root directory
RewriteBase /

# Ensure direct access to existing files/directories
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d

# Prevent direct access to PHP files except index.php
RewriteCond %{THE_REQUEST} "^[A-Z]{3,}\s([^.]+)\.php [NC]"
RewriteRule ^ %1 [R=301,L]

# Allow direct access to assets
RewriteCond %{REQUEST_URI} !^/images/
RewriteCond %{REQUEST_URI} !^/css/
RewriteCond %{REQUEST_URI} !^/js/
RewriteCond %{REQUEST_URI} !^/fonts/
RewriteCond %{REQUEST_URI} !^/assets/

# Route all requests through index.php
RewriteRule ^(.*)$ index.php [QSA,L]

# Security headers
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-XSS-Protection "1; mode=block"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Prevent directory listing
Options -Indexes

# Set default character set
AddDefaultCharset UTF-8

# Enable CORS for assets
<FilesMatch "\.(jpg|jpeg|png|gif|css|js|woff|woff2)$">
    <IfModule mod_headers.c>
        Header set Access-Control-Allow-Origin "*"
    </IfModule>
</FilesMatch>

# Cache control for static assets
<FilesMatch "\.(jpg|jpeg|png|gif|js|css|woff|woff2)$">
    Header set Cache-Control "max-age=31536000, public"
</FilesMatch> 